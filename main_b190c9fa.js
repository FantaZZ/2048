!function(e){function t(t){for(var r,n,a=t[0],l=t[1],u=t[2],c=0,f=[];c<a.length;c++)n=a[c],o[n]&&f.push(o[n][0]),o[n]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);for(h&&h(t);f.length;)f.shift()();return s.push.apply(s,u||[]),i()}function i(){for(var e,t=0;t<s.length;t++){for(var i=s[t],r=!0,a=1;a<i.length;a++){var l=i[a];0!==o[l]&&(r=!1)}r&&(s.splice(t--,1),e=n(n.s=i[0]))}return e}var r={},o={1:0},s=[];function n(t){if(r[t])return r[t].exports;var i=r[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=r,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="";var a=window.webpackJsonp=window.webpackJsonp||[],l=a.push.bind(a);a.push=t,a=a.slice();for(var u=0;u<a.length;u++)t(a[u]);var h=l;s.push([1073,0]),i()}({1073:function(e,t,i){"use strict";i(1072);var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i(432)),o=i(208),s=[];for(var n in r)s.push(r[n]);var a={type:Phaser.AUTO,parent:"app",backgroundColor:12299680,width:4*o.TILE_SIZE+5*o.TILE_SPACING,height:(4*o.TILE_SIZE+5*o.TILE_SPACING)/.5625,scene:s};window.game=new Phaser.Game(a)},208:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ROW=0,t.COL=1,t.TILE_SIZE=80,t.TILE_SPACING=8,t.TWEEN_DURATION=100,t.LOCAL_STORAGE_NAME="L2048"},431:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=i(208),s=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,{key:"MainScene"}));return e.tileArray=[],e.canMove=!1,e.score=0,e.bestScore=null==localStorage.getItem(o.LOCAL_STORAGE_NAME)?0:localStorage.getItem(o.LOCAL_STORAGE_NAME),e.handleTouch=function(t){var i=t.upTime-t.downTime,r=new Phaser.Geom.Point(t.upX-t.downX,t.upY-t.downY),o=Phaser.Geom.Point.GetMagnitude(r),s=new Phaser.Geom.Point(r.x/o,r.y/o);if(o>20&&i<1e3&&(Math.abs(s.y)>.8||Math.abs(s.x)>.8)){var n=e.tileGroup.getChildren();if(s.x>.8){for(var a=0;a<n.length;a++)n[a].depth=game.config.width-n[a].x;console.log("向右"),e.move(0,1)}if(s.x<-.8){for(a=0;a<n.length;a++)n[a].depth=n[a].x;console.log("向左"),e.move(0,-1)}if(s.y>.8){for(a=0;a<n.length;a++)n[a].depth=game.config.height-n[a].y;console.log("向下"),e.move(1,0)}if(s.y<-.8){for(a=0;a<n.length;a++)n[a].depth=n[a].y;console.log("向上"),e.move(-1,0)}}},e.handleKey=function(t){if(console.log(e.canMove),e.canMove){var i=e.tileGroup.getChildren();switch(t.code){case"KeyA":case"ArrowLeft":for(var r=0;r<i.length;r++)i[r].depth=i[r].x;console.log("向左"),e.move(0,-1);break;case"KeyD":case"ArrowRight":for(r=0;r<i.length;r++)i[r].depth=game.config.width-i[r].x;console.log("向右"),e.move(0,1);break;case"KeyW":case"ArrowUp":for(r=0;r<i.length;r++)i[r].depth=i[r].y;console.log("向上"),e.move(-1,0);break;case"KeyS":case"ArrowDown":for(r=0;r<i.length;r++)i[r].depth=game.config.height-i[r].y;console.log("向下"),e.move(1,0)}}},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Phaser.Scene),r(t,[{key:"preload",value:function(){this.load.image("tile_default","assets/sprites/tile_default.png"),this.load.image("restart","assets/sprites/restart.png"),this.load.image("score","assets/sprites/score.png"),this.load.image("score_best","assets/sprites/score_best.png"),this.load.spritesheet("tiles","assets/sprites/tiles.png",{frameWidth:o.TILE_SIZE,frameHeight:o.TILE_SIZE}),this.load.audio("move",["assets/sounds/move.ogg","assets/sounds/move.mp3"]),this.load.audio("grow",["assets/sounds/grow.ogg","assets/sounds/grow.mp3"])}},{key:"create",value:function(){this.layout(),this.addTile(),this.addTile(),this.addEvent(),this.addSound()}},{key:"addSound",value:function(){this.moveSound=this.sound.add("move"),this.growSound=this.sound.add("grow")}},{key:"addEvent",value:function(){this.input.on("pointerup",this.handleTouch),this.input.keyboard.on("keydown",this.handleKey)}},{key:"move",value:function(e,t){this.canMove=!1,this.movingTiles=0;for(var i=!1,r=0,s=0;s<4;s++)for(var n=0;n<4;n++){var a=1===e?3-s:s,l=1===t?3-n:n,u=this.tileArray[a][l].tileValue;if(0!==u){for(var h=e,c=t;this.isInsideBoard(a+h,l+c)&&0===this.tileArray[a+h][l+c].tileValue;)c+=t,h+=e;this.isInsideBoard(a+h,l+c)&&this.tileArray[a+h][l+c].tileValue===u&&this.tileArray[a+h][l+c].canUpgrade&&this.tileArray[a][l].canUpgrade&&u<12?(this.tileArray[a+h][l+c].tileValue++,r+=Math.pow(2,this.tileArray[a+h][l+c].tileValue),this.tileArray[a+h][l+c].canUpgrade=!1,this.tileArray[a][l].tileValue=0,this.moveTile(this.tileArray[a][l],a+h,l+c,Math.abs(h+c),!0),i=!0):(h-=e,0==(c-=t)&&0===h||(this.tileArray[a+h][l+c].tileValue=u,this.tileArray[a][l].tileValue=0,this.moveTile(this.tileArray[a][l],a+h,l+c,Math.abs(h+c),!1),i=!0))}}i?(this.moveSound.play(),this.score+=r,this.score>this.bestScore&&(this.bestScore=this.score,localStorage.setItem(o.LOCAL_STORAGE_NAME,this.bestScore))):this.canMove=!0}},{key:"moveTile",value:function(e,t,i,r,s){var n=this;this.movingTiles++,this.tweens.add({targets:[e.tileSprite],x:this.setPosition(i,o.COL),y:this.setPosition(t,o.ROW),duration:o.TWEEN_DURATION*r,onComplete:function(){n.movingTiles--,s&&n.transformTile(e,t,i),0===n.movingTiles&&(n.scoreText.setText(n.score),n.bestScoreText.setText(n.bestScore),n.resetTiles(),n.addTile())}})}},{key:"transformTile",value:function(e,t,i){var r=this;this.growSound.play(),this.movingTiles++,e.tileSprite.setFrame(this.tileArray[t][i].tileValue-1),this.tweens.add({targets:[e.tileSprite],scaleX:1.1,scaleY:1.1,duration:o.TWEEN_DURATION,yoyo:!0,repeat:1,onComplete:function(){r.movingTiles--,0===r.movingTiles&&(r.scoreText.setText(r.score),r.bestScoreText.setText(r.bestScore),r.resetTiles(),r.addTile())}})}},{key:"resetTiles",value:function(){for(var e=0;e<4;e++)for(var t=0;t<4;t++)this.tileArray[e][t].canUpgrade=!0,this.tileArray[e][t].tileSprite.x=this.setPosition(t,o.COL),this.tileArray[e][t].tileSprite.y=this.setPosition(e,o.ROW),this.tileArray[e][t].tileValue>0?(this.tileArray[e][t].tileSprite.alpha=1,this.tileArray[e][t].tileSprite.visible=!0,this.tileArray[e][t].tileSprite.setFrame(this.tileArray[e][t].tileValue-1)):(this.tileArray[e][t].tileSprite.alpha=0,this.tileArray[e][t].tileSprite.visible=!1)}},{key:"layout",value:function(){this.layout_header(),this.layout_body()}},{key:"layout_header",value:function(){var e=this;this.add.sprite(this.setPosition(0,o.COL)+30,this.setPosition(0,o.ROW)-100,"score"),this.add.sprite(this.setPosition(1,o.COL)+40,this.setPosition(0,o.ROW)-100,"score_best");var t=this.add.sprite(this.setPosition(3,o.COL)-10,this.setPosition(0,o.ROW)-87,"restart");t.setInteractive(),t.on("pointerdown",function(){e.scene.start("MainScene")}),this.scoreText=this.add.text(this.setPosition(0,o.COL)+30,this.setPosition(0,o.ROW)-90,"0",{fontFamily:"Arial",fontSize:22,fill:"#ffffff"}).setOrigin(.5),this.bestScoreText=this.add.text(this.setPosition(1,o.COL)+40,this.setPosition(0,o.ROW)-90,this.bestScore,{fontFamily:"Arial",fontSize:22,fill:"#ffffff"}).setOrigin(.5)}},{key:"layout_body",value:function(){this.tileGroup=this.add.group();for(var e=0;e<4;e++){this.tileArray[e]=[];for(var t=0;t<4;t++){this.add.sprite(this.setPosition(t,o.COL),this.setPosition(e,o.ROW),"tile_default");var i=this.add.sprite(this.setPosition(t,o.COL),this.setPosition(e,o.ROW),"tiles");i.alpha=0,i.visible=!1,this.tileArray[e][t]={tileValue:0,tileSprite:i,canUpgrade:!0},this.tileGroup.add(i)}}}},{key:"setPosition",value:function(e,t){var i=t===o.ROW?100:0;return e*(o.TILE_SIZE+o.TILE_SPACING)+.5*o.TILE_SIZE+o.TILE_SPACING+i}},{key:"addTile",value:function(){for(var e=this,t=[],i=0;i<4;i++)for(var r=0;r<4;r++)0===this.tileArray[i][r].tileValue&&t.push({row:i,col:r});if(t.length>0){var s=Phaser.Utils.Array.GetRandom(t);this.tileArray[s.row][s.col].tileValue=1,this.tileArray[s.row][s.col].tileSprite.visible=!0,this.tileArray[s.row][s.col].tileSprite.setFrame(0),this.tweens.add({targets:[this.tileArray[s.row][s.col].tileSprite],alpha:1,duration:o.TWEEN_DURATION,onCompolete:function(){e.canMove=!0}})}}},{key:"isInsideBoard",value:function(e,t){return e>=0&&t>=0&&e<4&&t<4}}]),t}();t.default=s},432:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(431);Object.defineProperty(t,"MainScene",{enumerable:!0,get:function(){return function(e){return e&&e.__esModule?e:{default:e}}(r).default}})}});